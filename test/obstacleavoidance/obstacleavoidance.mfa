program obstacleavoidance

group Axis [Driver,Front,Back]
group LeftWheel
group RightWheel
	

robot {
	void steer (byte degrees) {
		rotate(@Axis.Front,degrees);
		rotate(@Axis.Back,-degrees);
	}
	
	void drive (byte dirLeft, byte dirRight) {
		rotate_continuous(@LeftWheel,dirLeft);
		rotate_continuous(@RightWheel,dirRight);
	}
	
	void halt () {
		stop(@LeftWheel);
		stop(@RightWheel);
	}
}

sequence Init {
	do {
		when (#(connSource:SOUTH&EAST&FEMALE, connDest:EAST)) {
			module.group = @LeftWheel;
		}
		
		when (#(connSource:SOUTH&EAST&FEMALE, connDest:WEST)) {
			module.group = @RightWheel;
		} 
		
		when (#(@RightWheel) || #(@LeftWheel) && !#(connSource: NORTH&EAST&FEMALE)) {
			module.id = @Axis.Front;
		}
		
		when (#(@RightWheel) || #(@LeftWheel) && !#(connSource: NORTH&EAST&FEMALE)) {
			module.id = @Axis.Back;
		}
		
		when (#(@Axis) == 2) {
			module.id = @Axis.Driver;
		}
	} until (config.assignTime);
	
	goto Drive;
}	


sequence Drive {
 	when (module.group == @Axis && module.proximity() > config.proximity) {
		if (#(@Axis) == 2) {
			meta.size = 3;
			goto TurnTwoWheeler;
		}
		
		if (#(@Axis) == 3) {
			meta.size = 7;
			goto TurnFourWheeler;
		}	
	}	
	
	// FORWARD and BACKBWARD should be built in constants of 1 and -1, resp.
	robot.drive(FORWARD,FORWARD);
}





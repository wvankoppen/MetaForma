program Brandt
group Clover [North,South,West,East]

sequence FlipAlong  {
	byte QUART; 
	byte HALF;
	
	// if (orientation matches TOP_LEFT, RIGHT_TOP, BOTTOM_RIGHT, RIGHT_BOTTOM) {
	if(true){
		QUART = -90;
		HALF = -180;
	}
	else {
		QUART = 90;
		HALF = 180;
	}
	
	
	module.gradientInit();
	module.gradientPropagate();

		
	do {		
		if (gradPri==3 && gradSec==0) module.id = @Clover.West;
		if (gradPri==2 && gradSec==0) module.id = @Clover.South;
		if (gradPri==3 && gradSec==1) module.id = @Clover.North;
		if (gradPri==2 && gradSec==1) module.id = @Clover.East;
		module.isRef = (gradPri == 0 && gradSec == 3);
	}
			 
	
	disconnect(@Clover.West,@Clover.South);
	rotate(@Clover.East,QUART);
	// rotate(North@Clover,HALF);
	// rotate(East@Clover,QUART);
	// connect(North@Clover,@Floor);
	// connect(West@Clover,@Floor);
	// 
	// do {
	// 	disconnect(East@Clover,@Floor);
	// 	disconnect(South@Clover,@Floor);
	// }
	// 
	// rotate(East@Clover,-QUART);
	// rotate(North@Clover,QUART);
	// rotate(East@Clover,-QUART);
	// rotate(North@Clover,QUART);
	// connect(South@Clover,West@Clover);
	
	module.fixSymmetry(isRef);// store only works on current file instead of others
	
	// do {
	// 	when (receive (Symmetry p)) {
	// 		module.fixSymmetry (p.connSource,p.connDest);
	// 	}
	// 	if (isRef) {
	// 		unicast Symmetry() to $(inRegion:true);
	// 	}
	// }
	
	region.finish();
}

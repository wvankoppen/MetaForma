package Brandt

group Uplifter [Top,Bottom,Left,Right]
group Dummy [Left,Right]
 
sequence FlipThrough {
	if (BOTTOM_RIGHT, RIGHT_TOP, LEFT_BOTTOM) {
		QUART = 90;
		HALF = 180; 
	}
	else {
		QUART = -90; 
		HALF = -180;
	}
	module.gradientInit();
	
	do {
		module.gradientPropagate();
	} until (config.propagationTime);
	
	do {
		if (gradPri==1 && gradSec==1) module.id = @Uplifter.Left;
		if (gradPri==2 && gradSec==0) module.id = @Uplifter.Right;
		if (gradPri==1 && gradSec==0) module.id = @Dummy.Left;
		if (gradPri==0 && gradSec==0) module.id = @Uplifter.Top;
		if (gradPri==2 && gradSec==1) module.id = @Dummy.Right;
		if (gradPri==3 && gradSec==1) module.id = @Uplifter.Bottom;			
		isRef = gradPri==3 && gradSec==0;
	}
	do  {				 
		disconnect(@Uplifter.Left,@Dummy.Left);
		disconnect(@Uplifter.Right,@Dummy.Right);
	} 
	do  {				
		rotate(@Uplifter.Left, QUART);
		rotate(@Uplifter.Right, QUART);
	} 
	disconnect(@Uplifter.Left,@Dummy.Right);
	rotate(@Uplifter.Bottom, HALF);
	do  {				
		rotate(@Uplifter.Left, QUART);
		rotate(@Uplifter.Right, QUART);
	} 
	do  {				
		// rotate(@Uplifter.Right, HALF);
		rotate(@Uplifter.Top, HALF);
	}
	 
	module.restoreID();
	connect(@X, @X);	
	module.fixSymmetry(isRef);
	disable meta;
}